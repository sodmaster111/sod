# SODMASTER โ CHAT MEMORY

## โ ะขะตะบััะธะน ััะฐััั ะฟัะพะตะบัะฐ

SODMASTER โ ะฐะฒัะพะฝะพะผะฝะพะต AI-ะฐะณะตะฝัััะฒะพ ะดะปั ัะฐัะฟัะพัััะฐะฝะตะฝะธั ะธัะดะฐะธะทะผะฐ (ะขะพัะฐ, ืชืคืืื, ืืืืื) ัะตัะตะท ัะฐะนั, Telegram ะธ WhatsApp ะฝะฐ ัะพะฑััะฒะตะฝะฝะพะผ VPS.

ะกะตะนัะฐั:

- ะััั ัะฟัะพะตะบัะธัะพะฒะฐะฝะฝัะน ะผะพะฝะพัะตะฟะพะทะธัะพัะธะน `sodmaster/` ั ะผะพะดัะปัะผะธ `backend/`, `web/`, `ai/`, `infra/`.
- ะงะตัะตะท Codex ัะถะต ะฑัะป ัะณะตะฝะตัะธัะพะฒะฐะฝ ะธ ัะฐััะธัะฝะพ ะทะฐะฟััะตะฝ backend (FastAPI) ะธ web (Next.js 14 + Tailwind).
- ะ ะธะฝััะฐััััะบัััะต ะฟะพะดะฝััั ะบะพะฝัะตะนะฝะตัั `web` ะธ `ollama`; backend ะฟะพะดะฝะธะผะฐะปัั ะธ ะพัะฒะตัะฐะป ะฝะฐ `/`.
- ะััั API ะดะปั ะฐะณะตะฝัะพะฒ (`/api/agents/generate`) ะธ health-ัะฝะดะฟะพะธะฝัั (`/api/health`, `/api/health/llm`).
- ะัะพะตะบั ะธะทะฝะฐัะฐะปัะฝะพ ะทะฐะดัะผะฐะฝ ะบะฐะบ **self-hosted AI**: ะฒ ัะฐะฝัะฐะนะผะต ะธัะฟะพะปัะทััััั ัะพะปัะบะพ ะปะพะบะฐะปัะฝัะต ะผะพะดะตะปะธ (Ollama ะธ ะดั.), ะฑะตะท ะพะฑะปะฐัะฝัั API.

## โ๏ธ ะะบัะธะฒะฝัะต ะฟัะพะฑะปะตะผั

- ะะต ะทะฐัะธะบัะธัะพะฒะฐะฝะพ ะตะดะธะฝะพะต ัะตะบััะตะต ัะพััะพัะฝะธะต ะฟัะพะตะบัะฐ ะฒ ะพะดะฝะพะผ ัะตะฝััะฐะปัะฝะพะผ ัะฐะนะปะต (CHAT_MEMORY) โ ััะพั ัะฐะนะป ัะพะทะดะฐัััั ัะตะนัะฐั.
- ะะพะณะธะบะฐ โะฝะต ะฟะพััะธัั ะฒ ะฟัะฐะทะดะฝะธะบะธ (ะนะพะผ-ัะพะฒ)โ ะฟะพะบะฐ ะฝะต ะฟะพะปะฝะพัััั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะฒ ะบะพะดะต (ะตััั ัะพะปัะบะพ ะบะพะฝัะตะฟัะธั + ัะฐะฑะฑะฐั).
- ะะฝัะตะณัะฐัะธั Telegram-ะฑะพัะฐ ั backend (agents API) ะฝะฐัะฐัะฐ, ะฝะพ ะฝะต ะดะพะฒะตะดะตะฝะฐ ะดะพ ะบะพะฝัะฐ:
  - `.env` ั TELEGRAM_BOT_TOKEN ะธ TELEGRAM_CHANNEL_ID ัะพะทะดะฐะฒะฐะปัั, ะฝะพ ะฝะตั ะทะฐะฒะตัััะฝะฝะพะณะพ ะบะพะดะฐ ะฑะพัะฐ ะธ docker-ัะตัะฒะธัะฐ.
- ะกะพััะพัะฝะธะต `infra/docker-compose.yml` ะธ ัะตะฐะปัะฝัั ะบะพะฝัะตะนะฝะตัะพะฒ backend/web/ollama ะฝัะถะฝะพ ะฟะตัะตะฟัะพะฒะตัะธัั:
  - ะฟะพ ะปะพะณะฐะผ `sod-ollama` ะธ `sod-web` ะฑัะปะธ ะฒ Up,
  - `sod-backend` ะฟะตัะธะพะดะธัะตัะบะธ ััะพะดะธะป ะฒ Restarting.
- ะะฝะพะณะพ ะปะพะณะธะบะธ ะธ ะฐััะธัะตะบัััะฝัั ัะตัะตะฝะธะน ะฟะพะบะฐ ะถะธะฒัั ะฒ ัะฐัะต ะธ ะพัะดะตะปัะฝัั .md ัะฐะนะปะฐั ะฑะตะท ะถัััะบะพะณะพ ะฐะฒัะพะผะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั (Codex โ memory/codex_runs โ CHAT_MEMORY).

## โ ะงัะพ ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ

### ะะธะทะธั ะธ ัะตะปั

- ะะฟัะตะดะตะปะตะฝะฐ ะผะธััะธั: SODMASTER โ ัะธััะพะฒะพะต ะฐะณะตะฝัััะฒะพ, ะธัะฟะพะปัะทัััะตะต AI ะดะปั ัะฐัะฟัะพัััะฐะฝะตะฝะธั ะขะพัั, ะฒะตัั ะธ ะผะพะปะธัะฒั ัะตัะตะท ัะฐะนั ะธ ะผะตััะตะฝะดะถะตัั.
- ะะฐะฝะฐะปั: ัะฐะนั, Telegram-ะบะฐะฝะฐะป ะธ ะฑะพั, WhatsApp-ะณััะฟะฟะฐ/ัะพะพะฑัะตััะฒะพ, ั ัะพะบััะพะผ ะฝะฐ ะฒะดะพัะฝะพะฒะปัััะตะผ ะธ โะบะพัะตัะฝะพะผโ ะบะพะฝัะตะฝัะต.

### ะััะธัะตะบัััะฐ ะธ ัะตะฟะพะทะธัะพัะธะน

- ะกะฟัะพะตะบัะธัะพะฒะฐะฝ ะผะพะฝะพัะตะฟะพะทะธัะพัะธะน `sodmaster/`:

  - `backend/` โ FastAPI, ะฐะณะตะฝัั, ะปะพะณะธะบะฐ ะบะฐะฝะฐะปะพะฒ.
  - `web/` โ Next.js 14 (App Router) + Tailwind, ัะฐะนั ะฝะฐ ะธะฒัะธัะต.
  - `ai/` โ ะบะปะธะตะฝั ะดะปั ะปะพะบะฐะปัะฝะพะณะพ LLM-ัะตัะฒะธัะฐ (Ollama).
  - `infra/` โ docker-compose, Ollama, ะฑัะดััะธะน proxy.

- ะะพะดะณะพัะพะฒะปะตะฝั ะดะตัะฐะปัะฝัะต ะขะ ะดะปั Codex, ััะพะฑั ัะณะตะฝะตัะธัะพะฒะฐัั ะฒัั ััััะบัััั ะธ ะพัะฝะพะฒะฝัะต ัะฐะนะปั (requirements, pyproject, Dockerfileโั, next.config, tailwind.config ะธ ั.ะด.).

### Backend (FastAPI)

- ะะตะฐะปะธะทะพะฒะฐะฝะฐ ััััะบัััะฐ backend:

  - `app/core/config.py` ั ะบะปะฐััะพะผ `Settings` (PROJECT_NAME, API_V1_STR, LLM_API_BASE, LLM_MODEL_NAME).
  - `app/api/health.py`:
    - GET `/health` โ `{"status": "ok"}`
    - GET `/health/llm` โ ะฟัะพะฒะตัะบะฐ ัะฒัะทะธ ั ะปะพะบะฐะปัะฝัะผ LLM.
  - `app/agents/base.py` โ ะฑะฐะทะพะฒะฐั ะผะพะดะตะปั ะฐะณะตะฝัะฐ.
  - `app/agents/profiles.py` โ ะฟัะพัะธะปะธ 5 ะฐะณะตะฝัะพะฒ:
    - `ceo_agent` โ ัััะฐัะตะณะธัะตัะบะพะต ะธ ะดััะพะฒะฝะพะต ะฒะธะดะตะฝะธะต ะฟัะพะตะบัะฐ.
    - `cmo_agent` โ ะบะพะฝัะตะฝั-ะฟะปะฐะฝ ะธ ะผะฐัะบะตัะธะฝะณ ะดะปั web/Telegram/WhatsApp.
    - `rabbi_agent` โ ะบะพัะพัะบะธะต ืืืจ ืชืืจื, ืชืคืืืืช, ะฟะพัะปะฐะฝะธั ะฒะตัั (ะธะฒัะธั first).
    - `writer_agent` โ ัะตะดะฐะบัััะฐ ะธ ะฐะดะฐะฟัะฐัะธั ัะตะบััะพะฒ ะฟะพะด ัะฐะทะฝัะต ะบะฐะฝะฐะปั.
    - `community_agent` โ ัะฟัะฐะฒะปะตะฝะธะต ะฑะพัะฐะผะธ, ัะฐัะฟะธัะฐะฝะธัะผะธ, ัะฒะฐะถะตะฝะธะต ะจะฐะฑะฑะฐัะฐ ะธ ะะพะผ-ัะพะฒ.
  - `app/agents/llm_client.py` โ HTTP-ะบะปะธะตะฝั ะบ ะปะพะบะฐะปัะฝะพะผั LLM-ัะตัะฒะธัั (Ollama).
  - `app/api/agents.py` โ endpoint POST `/api/agents/generate`:
    - ะฟัะธะฝะธะผะฐะตั `agent_name` ะธ `user_prompt`,
    - ะฝะฐัะพะดะธั ะฟัะพัะธะปั ะฐะณะตะฝัะฐ,
    - ัััะพะธั system prompt,
    - ะฒัะทัะฒะฐะตั LLMClient,
    - ะฒะพะทะฒัะฐัะฐะตั ะพัะฒะตั ะฐะณะตะฝัะฐ.

- `app/main.py`:
  - ะะฐะณะพะปะพะฒะพะบ ะฟัะธะปะพะถะตะฝะธั โ SODMASTER AI Agency.
  - ะะพะดะบะปััะตะฝะธะต health ะธ agents routers.
  - GET `/` โ `{"status": "SODMASTER AI Agency is online"}`.

### Frontend (Next.js)

- ะกะพะทะดะฐะฝ ะผะธะฝะธะผะฐะปัะฝัะน Next.js 14 ัะฐะนั:

  - `app/layout.tsx`:
    - `<html lang="he">` + ะฑะฐะทะพะฒัะน layout ั Tailwind.
    - Header: ะฑัะตะฝะด โSODMASTERโ ะธ ะฟะพะดะทะฐะณะพะปะพะฒะพะบ โืกืืืืืช ืืึพืืื ืืืคืฆืช ืืืืื ืืชืืจืโ.
  - `app/page.tsx`:
    - hero-ัะตะบัะธั:
      - H1: โืืคืืฆืื ืชืืจื ืืืืืื ืืขืืื ืืืืืืืืโ.
      - P: ะพะฑัััะฝะตะฝะธะต ะผะธััะธะธ ะฟัะพะตะบัะฐ (ืืืื ืืืืืืชืืช ืืืคืฆืช ืชืืจื, ืืืืื ืืชืคืืื).
      - ะดะฒะต ะบะฝะพะฟะบะธ (ะฟะพะบะฐ ะฑะตะท ัะตะฐะปัะฝัั ัััะปะพะบ):
        - โืืฆืืจืคืืช ืืงืืืฆืช ืืืืืกืืคโ
        - โืืฆืืจืคืืช ืืขืจืืฅ ืืืืืจืโ
    - ัะตะบัะธั ั 3 ะบะพะปะพะฝะบะฐะผะธ:
      - โืืืืื ืชืืจืโ
      - โืชืคืืื ืืืืืชโ
      - โืงืืืื ืืืืงืชโ
  - `globals.css`:
    - Tailwind base/components/utilities.
    - ัะพะฝ `#f9fafb`, ัะตะบัั `#111827`.

### ะะฝััะฐััััะบัััะฐ ะธ Ollama

- `infra/docker-compose.yml` ะฟะพะดะฝะธะผะฐะตั 3 ัะตัะฒะธัะฐ:

  - `backend`:
    - build `./backend`,
    - env: `LLM_API_BASE=http://ollama:11434`, `LLM_MODEL_NAME=llama3`,
    - ะฟะพัั `8000:8000`,
    - ะทะฐะฒะธัะธั ะพั `ollama`,
    - `restart: unless-stopped`.

  - `web`:
    - build `./web`,
    - ะฟะพัั `3000:3000`,
    - ะทะฐะฒะธัะธั ะพั `backend`,
    - `restart: unless-stopped`.

  - `ollama`:
    - `ollama/ollama:latest`,
    - volume `./infra/ollama:/root/.ollama`,
    - ะฟะพัั `11434:11434`,
    - `restart: unless-stopped`.

- ะ `infra/ollama/README.md` ะพะฟะธัะฐะฝ ะทะฐะฟััะบ `docker compose up -d` ะธ `ollama pull llama3`.

- ะะพ ัะพััะพัะฝะธั ะฝะฐ ะฟะพัะปะตะดะฝะธะน ะปะพะณ:
  - ะบะพะฝัะตะนะฝะตัั `web` ะธ `ollama` ะฑัะปะธ ะฒ ััะฐัััะต Up,
  - backend ะฟะพะดะฝะธะผะฐะปัั ะธ ะพัะฒะตัะฐะป ะฝะฐ `/`, ะฝะพ ะฟะพะทะถะต ััะฐะปะบะธะฒะฐะปัั ั ัะตััะฐััะฐะผะธ.

### ะะณะตะฝัั ะธ ะบะพะฝัะตะฝั

- ะะฟัะตะดะตะปัะฝ ะฑะฐะทะพะฒัะน ะฝะฐะฑะพั ะฐะณะตะฝัะพะฒ (CEO, CMO, Rabbi, Writer, Community) ะบะฐะบ ะปะพะณะธัะตัะบะธะต ะฟัะพัะธะปะธ.
- ะัะพะดัะผะฐะฝะฐ ััะตะผะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั `/api/agents/generate` ะดะปั ะณะตะฝะตัะฐัะธะธ:
  - ะดััะพะฒะฝัั ะฟะพัะปะฐะฝะธะน,
  - ะพะฑัััะฝะตะฝะธะน ะฝะพะฒะพััะตะน,
  - ะตะถะตะดะฝะตะฒะฝัั ะผะพะปะธัะฒ ะธ ะฟัะฐะปะผะพะฒ.

### ะัะฐะฒะธะปะพ โะฝะต ะฟะพััะธัั ะฒ ะจะฐะฑะฑะฐั ะธ ะะพะผ-ัะพะฒโ

- ะะฐ ะบะพะฝัะตะฟััะฐะปัะฝะพะผ ััะพะฒะฝะต ะทะฐัะธะบัะธัะพะฒะฐะฝะพ ะฟัะฐะฒะธะปะพ:
  - ะฝะต ะพัะฟัะฐะฒะปััั ะฐะฒัะพะผะฐัะธัะตัะบะธะต ัะพะพะฑัะตะฝะธั ะฒ ะจะฐะฑะฑะฐั,
  - ะฝะต ะพัะฟัะฐะฒะปััั ะฒ ะะผ-ัะพะฒ (ะฟัะฐะทะดะฝะธะบะธ),
  - ัะตะฐะปะธะทะพะฒัะฒะฐัั ััะพ ัะตัะตะท ััะฝะบัะธั `is_no_send_time` ะธ/ะธะปะธ ะพัะดะตะปัะฝัะน ะผะพะดัะปั Jewish calendar.
- ะ ะพัะดะตะปัะฝะพะผ ะผะพะดัะปะต (jewish_calendar) ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝ stub:
  - `is_no_send_time` ัะพัั ะฑั ะดะปั ะจะฐะฑะฑะฐัะฐ;
  - endpoint `/api/time/status`, ะฒะพะทะฒัะฐัะฐััะธะน ัะปะฐะณะธ `is_shabbat` ะธ `is_no_send_time`.

### ะกะธััะตะผะฐ ะฟะฐะผััะธ (GitHub + Markdown + ะฑะฐะทะฐ)

- ะกะฟัะพะตะบัะธัะพะฒะฐะฝะฐ ััััะบัััะฐ `/memory`:

  - `/memory/codex_runs` โ ัะฐะนะปั ะปะพะณะฐ ะบะฐะถะดะพะณะพ ะทะฐะฟััะบะฐ Codex.
  - `/memory/decisions` โ ะบะปััะตะฒัะต ัะตัะตะฝะธั.
  - `/memory/architecture` โ ะธััะพัะธัะตัะบะธะต ะฐััะธัะตะบัััะฝัะต ะฒะฐัะธะฐะฝัั.
  - `/memory/logs` โ ะฒะฐะถะฝัะต ะปะพะณ-ะทะฐะฟะธัะธ.

- ะจะฐะฑะปะพะฝ `Codex Run`:
  - ะฆะตะปั, ะงัะพ ะดะตะปะฐะปะธ, ะะตะทัะปััะฐั, ะัะฒะพะด, ะกะปะตะดัััะธะน ัะฐะณ.

- ะกะฟัะพะตะบัะธัะพะฒะฐะฝะฐ ััััะบัััะฐ `/docs`:

  - `CORE.md` โ ะธะดะตั ะธ ะผะธััะธั.
  - `ARCH.md` โ ะฐััะธัะตะบัััะฐ.
  - `AGENTS.md` โ ะฐะณะตะฝัั ะธ ะธั ัะพะปะธ.
  - `SERVER.md` โ ัะตัะฒะตั ะธ ะธะฝััะฐััััะบัััะฐ.
  - `BOTS.md` โ Telegram/WhatsApp ะฑะพัั.
  - `CONTENT.md` โ ะบะพะฝัะตะฝั ะธ ะฟะพััะธะฝะณ.
  - `TASKS.md` โ ัะตะบััะธะต ะทะฐะดะฐัะธ.

- ะะฟะธัะฐะฝั ะฟัะฐะฒะธะปะฐ:
  - ะะต ะฒะตััะธ ะฒัั ะฒ ะพะดะฝะพะผ ัะฐัะต.
  - ะะฑะฝะพะฒะปััั `TASKS.md`, `SERVER.md`, `BOTS.md` ะตะถะตะดะฝะตะฒะฝะพ ะธะปะธ ะฟะพ ะผะตัะต ะธะทะผะตะฝะตะฝะธะน.
  - ะ ะฝะพะฒัะน ัะฐั ะฟะพะดะณััะถะฐัั ัะพะปัะบะพ 1โ2 ะฝัะถะฝัั `.md`, ะฐ ะฝะต ะฒะตัั ะฟัะพะตะบั.

## ๐ง ะะพัะปะตะดะฝะธะต ะธะทะผะตะฝะตะฝะธั

- [2025-12-02] ะกะฟัะพะตะบัะธัะพะฒะฐะฝ ะธ ัะฐััะธัะฝะพ ัะตะฐะปะธะทะพะฒะฐะฝ ะผะพะฝะพัะตะฟะพะทะธัะพัะธะน SODMASTER ั backend, web, infra ะธ Ollama.
- [2025-12-02] ะะตะฐะปะธะทะพะฒะฐะฝั ะฑะฐะทะพะฒัะต health-ัะฝะดะฟะพะธะฝัั ะธ API `/api/agents/generate` ะดะปั ะปะพะณะธัะตัะบะธั ะฟัะพัะธะปะตะน ะฐะณะตะฝัะพะฒ.
- [2025-12-02] ะะฐัััะพะตะฝ docker-compose ั ัะตัะฒะธัะฐะผะธ backend/web/ollama, ะบะพะฝัะตะนะฝะตัั web ะธ ollama ัะฐะฑะพัะฐัั.
- [2025-12-02] ะะฟัะตะดะตะปะตะฝะฐ ัะธััะตะผะฐ ัะฐะนะปะพะฒะพะน ะฟะฐะผััะธ: `/memory/*` ะธ `/docs/*`.
- [2025-12-02] ะะฟัะตะดะตะปะตะฝะพ ะฟัะฐะฒะธะปะพ ะฝะต ะฟะพััะธัั ะฒ ะจะฐะฑะฑะฐั ะธ ะะพะผ-ัะพะฒ, ัะตะฐะปะธะทะพะฒะฐะฝ ะฟะตัะฒัะน stub `is_no_send_time` ะธ endpoint `/api/time/status`.

## โก๏ธ ะกะปะตะดัััะธะน ัะฐะณ

1. ะะฐ ัะตัะฒะตัะต:
   - ะัะพะฒะตัะธัั ัะตะบััะตะต ัะพััะพัะฝะธะต ะบะพะฝัะตะนะฝะตัะพะฒ:
     - `cd /opt/sod/infra`
     - `docker compose ps`
   - ะฃะฑะตะดะธัััั, ััะพ backend ะฒ ััะฐัััะต Up; ะตัะปะธ ะฝะตั โ ะฟัะพัะผะพััะตัั `docker compose logs backend --tail=50` ะธ ะธัะฟัะฐะฒะธัั.

2. ะัะพะฒะตัะธัั API backend:
   - `curl http://localhost:8000/` (ะธะปะธ 8001, ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะตะบััะตะน ะบะพะฝัะธะณััะฐัะธะธ).
   - `curl http://localhost:8000/api/health`
   - `curl http://localhost:8000/api/health/llm` (ะฟะพัะปะต `ollama pull llama3`).

3. ะัะพัะตััะธัะพะฒะฐัั `rabbi_agent` ัะตัะตะท `/api/agents/generate`.

4. ะะฐะฒะตััะธัั ะธะฝัะตะณัะฐัะธั Telegram-ะฑะพัะฐ:
   - ะธัะฟะพะปัะทะพะฒะฐัั ัััะตััะฒัััะธะน `.env` ั TELEGRAM_BOT_TOKEN ะธ TELEGRAM_CHANNEL_ID,
   - ะฝะฐะฟะธัะฐัั ะผะพะดัะปั ะฑะพัะฐ, ะบะพัะพััะน ะพะฑัะฐัะฐะตััั ะบ `/api/agents/generate`,
   - ะพะฑะพัะฐัะธะฒะฐัั ะฟะพััะธะฝะณ ะฟัะพะฒะตัะบะพะน `is_no_send_time` (ะจะฐะฑะฑะฐั + ะฟัะฐะทะดะฝะธะบะธ ะฟะพ ะตะฒัะตะนัะบะพะผั ะบะฐะปะตะฝะดะฐัั).

5. ะะบะปััะธัั ะถะตะปะตะทะพะฑะตัะพะฝะฝัั ะดะธััะธะฟะปะธะฝั ะดะปั Codex:
   - ะฟะพัะปะต ะะะะะะะ ะทะฐะฟััะบะฐ Codex:
     - ะพะฑะฝะพะฒะปััั ััะพั ัะฐะนะป `docs/CHAT_MEMORY.md`,
     - ัะพะทะดะฐะฒะฐัั ะฝะพะฒัะน ัะฐะนะป ะฒ `memory/codex_runs/`,
     - ะดะตะปะฐัั `git add`, `git commit`, `git push`.
